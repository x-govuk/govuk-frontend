{"version":3,"file":"button.mjs","sources":["../../../../src/govuk/components/button/button.mjs"],"sourcesContent":["import { mergeConfigs } from '../../common/index.mjs'\nimport { normaliseDataset } from '../../common/normalise-dataset.mjs'\n\nconst KEY_SPACE = 32\nconst DEBOUNCE_TIMEOUT_IN_SECONDS = 1\n\n/**\n * JavaScript enhancements for the Button component\n */\nexport class Button {\n  /** @private */\n  $module\n\n  /**\n   * @private\n   * @type {ButtonConfig}\n   */\n  config\n\n  /**\n   * @private\n   * @type {number | null}\n   */\n  debounceFormSubmitTimer = null\n\n  /**\n   *\n   * @param {Element} $module - HTML element to use for button\n   * @param {ButtonConfig} [config] - Button config\n   */\n  constructor ($module, config) {\n    if (!($module instanceof HTMLElement) || !document.body.classList.contains('govuk-frontend-supported')) {\n      return this\n    }\n\n    this.$module = $module\n\n    this.config = mergeConfigs(\n      Button.defaults,\n      config || {},\n      normaliseDataset($module.dataset)\n    )\n\n    this.$module.addEventListener('keydown', (event) => this.handleKeyDown(event))\n    this.$module.addEventListener('click', (event) => this.debounce(event))\n  }\n\n  /**\n   * Trigger a click event when the space key is pressed\n   *\n   * Some screen readers tell users they can activate things with the 'button'\n   * role, so we need to match the functionality of native HTML buttons\n   *\n   * See https://github.com/alphagov/govuk_elements/pull/272#issuecomment-233028270\n   *\n   * @private\n   * @param {KeyboardEvent} event - Keydown event\n   */\n  handleKeyDown (event) {\n    const $target = event.target\n\n    // Handle space bar only\n    if (event.keyCode !== KEY_SPACE) {\n      return\n    }\n\n    // Handle elements with [role=\"button\"] only\n    if ($target instanceof HTMLElement && $target.getAttribute('role') === 'button') {\n      event.preventDefault() // prevent the page from scrolling\n      $target.click()\n    }\n  }\n\n  /**\n   * Debounce double-clicks\n   *\n   * If the click quickly succeeds a previous click then nothing will happen. This\n   * stops people accidentally causing multiple form submissions by double\n   * clicking buttons.\n   *\n   * @private\n   * @param {MouseEvent} event - Mouse click event\n   * @returns {undefined | false} Returns undefined, or false when debounced\n   */\n  debounce (event) {\n    // Check the button that was clicked has preventDoubleClick enabled\n    if (!this.config.preventDoubleClick) {\n      return\n    }\n\n    // If the timer is still running, prevent the click from submitting the form\n    if (this.debounceFormSubmitTimer) {\n      event.preventDefault()\n      return false\n    }\n\n    this.debounceFormSubmitTimer = window.setTimeout(() => {\n      this.debounceFormSubmitTimer = null\n    }, DEBOUNCE_TIMEOUT_IN_SECONDS * 1000)\n  }\n\n  /**\n   * Button default config\n   *\n   * @see {@link ButtonConfig}\n   * @constant\n   * @default\n   * @type {ButtonConfig}\n   */\n  static defaults = Object.freeze({\n    preventDoubleClick: false\n  })\n}\n\n/**\n * Button config\n *\n * @typedef {object} ButtonConfig\n * @property {boolean} [preventDoubleClick=false] - Prevent accidental double\n *   clicks on submit buttons from submitting forms multiple times.\n */\n"],"names":["KEY_SPACE","DEBOUNCE_TIMEOUT_IN_SECONDS","Button","constructor","$module","config","debounceFormSubmitTimer","HTMLElement","document","body","classList","contains","mergeConfigs","defaults","normaliseDataset","dataset","addEventListener","event","handleKeyDown","debounce","$target","target","keyCode","getAttribute","preventDefault","click","preventDoubleClick","window","setTimeout","Object","freeze"],"mappings":";;;AAGA,MAAMA,SAAS,GAAG,EAAE,CAAA;AACpB,MAAMC,2BAA2B,GAAG,CAAC,CAAA;;AAErC;AACA;AACA;AACO,MAAMC,MAAM,CAAC;AAgBlB;AACF;AACA;AACA;AACA;AACEC,EAAAA,WAAWA,CAAEC,OAAO,EAAEC,MAAM,EAAE;AApB9B;AAAA,IAAA,IAAA,CACAD,OAAO,GAAA,KAAA,CAAA,CAAA;AAEP;AACF;AACA;AACA;AAHE,IAAA,IAAA,CAIAC,MAAM,GAAA,KAAA,CAAA,CAAA;AAEN;AACF;AACA;AACA;IAHE,IAIAC,CAAAA,uBAAuB,GAAG,IAAI,CAAA;AAQ5B,IAAA,IAAI,EAAEF,OAAO,YAAYG,WAAW,CAAC,IAAI,CAACC,QAAQ,CAACC,IAAI,CAACC,SAAS,CAACC,QAAQ,CAAC,0BAA0B,CAAC,EAAE;AACtG,MAAA,OAAO,IAAI,CAAA;AACb,KAAA;IAEA,IAAI,CAACP,OAAO,GAAGA,OAAO,CAAA;IAEtB,IAAI,CAACC,MAAM,GAAGO,YAAY,CACxBV,MAAM,CAACW,QAAQ,EACfR,MAAM,IAAI,EAAE,EACZS,gBAAgB,CAACV,OAAO,CAACW,OAAO,CAClC,CAAC,CAAA;AAED,IAAA,IAAI,CAACX,OAAO,CAACY,gBAAgB,CAAC,SAAS,EAAGC,KAAK,IAAK,IAAI,CAACC,aAAa,CAACD,KAAK,CAAC,CAAC,CAAA;AAC9E,IAAA,IAAI,CAACb,OAAO,CAACY,gBAAgB,CAAC,OAAO,EAAGC,KAAK,IAAK,IAAI,CAACE,QAAQ,CAACF,KAAK,CAAC,CAAC,CAAA;AACzE,GAAA;;AAEA;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACEC,aAAaA,CAAED,KAAK,EAAE;AACpB,IAAA,MAAMG,OAAO,GAAGH,KAAK,CAACI,MAAM,CAAA;;AAE5B;AACA,IAAA,IAAIJ,KAAK,CAACK,OAAO,KAAKtB,SAAS,EAAE;AAC/B,MAAA,OAAA;AACF,KAAA;;AAEA;AACA,IAAA,IAAIoB,OAAO,YAAYb,WAAW,IAAIa,OAAO,CAACG,YAAY,CAAC,MAAM,CAAC,KAAK,QAAQ,EAAE;AAC/EN,MAAAA,KAAK,CAACO,cAAc,EAAE,CAAC;MACvBJ,OAAO,CAACK,KAAK,EAAE,CAAA;AACjB,KAAA;AACF,GAAA;;AAEA;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACEN,QAAQA,CAAEF,KAAK,EAAE;AACf;AACA,IAAA,IAAI,CAAC,IAAI,CAACZ,MAAM,CAACqB,kBAAkB,EAAE;AACnC,MAAA,OAAA;AACF,KAAA;;AAEA;IACA,IAAI,IAAI,CAACpB,uBAAuB,EAAE;MAChCW,KAAK,CAACO,cAAc,EAAE,CAAA;AACtB,MAAA,OAAO,KAAK,CAAA;AACd,KAAA;AAEA,IAAA,IAAI,CAAClB,uBAAuB,GAAGqB,MAAM,CAACC,UAAU,CAAC,MAAM;MACrD,IAAI,CAACtB,uBAAuB,GAAG,IAAI,CAAA;AACrC,KAAC,EAAEL,2BAA2B,GAAG,IAAI,CAAC,CAAA;AACxC,GAAA;;AAEA;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AAIA,CAAA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AA/GaC,MAAM,CAoGVW,QAAQ,GAAGgB,MAAM,CAACC,MAAM,CAAC;AAC9BJ,EAAAA,kBAAkB,EAAE,KAAA;AACtB,CAAC,CAAC;;;;"}