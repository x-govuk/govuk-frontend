{"version":3,"file":"exit-this-page.mjs","sources":["../../../../src/govuk/components/exit-this-page/exit-this-page.mjs"],"sourcesContent":["import { mergeConfigs, extractConfigByNamespace } from '../../common/index.mjs'\nimport { normaliseDataset } from '../../common/normalise-dataset.mjs'\nimport { I18n } from '../../i18n.mjs'\n\n/**\n * Exit This Page component\n */\nexport class ExitThisPage {\n  /** @private */\n  $module\n\n  /**\n   * @private\n   * @type {ExitThisPageConfig}\n   */\n  config\n\n  /** @private */\n  i18n\n\n  /** @private */\n  $button\n\n  /**\n   * @private\n   * @type {HTMLAnchorElement | null}\n   */\n  $skiplinkButton = null\n\n  /**\n   * @private\n   * @type {HTMLElement | null}\n   */\n  $updateSpan = null\n\n  /**\n   * @private\n   * @type {HTMLElement | null}\n   */\n  $indicatorContainer = null\n\n  /**\n   * @private\n   * @type {HTMLElement | null}\n   */\n  $overlay = null\n\n  /** @private */\n  keypressCounter = 0\n\n  /** @private */\n  lastKeyWasModified = false\n\n  /** @private */\n  timeoutTime = 5000 // milliseconds\n\n  // Store the timeout events so that we can clear them to avoid user keypresses overlapping\n  // setTimeout returns an id that we can use to clear it with clearTimeout,\n  // hence the 'Id' suffix\n\n  /**\n   * @private\n   * @type {number | null}\n   */\n  keypressTimeoutId = null\n\n  /**\n   * @private\n   * @type {number | null}\n   */\n  timeoutMessageId = null\n\n  /**\n   * @param {Element} $module - HTML element that wraps the Exit This Page button\n   * @param {ExitThisPageConfig} [config] - Exit This Page config\n   */\n  constructor ($module, config) {\n    if (!($module instanceof HTMLElement) || !document.body.classList.contains('govuk-frontend-supported')) {\n      return this\n    }\n\n    const $button = $module.querySelector('.govuk-exit-this-page__button')\n    if (!($button instanceof HTMLElement)) {\n      return this\n    }\n\n    this.config = mergeConfigs(\n      ExitThisPage.defaults,\n      config || {},\n      normaliseDataset($module.dataset)\n    )\n\n    this.i18n = new I18n(extractConfigByNamespace(this.config, 'i18n'))\n    this.$module = $module\n    this.$button = $button\n\n    const $skiplinkButton = document.querySelector('.govuk-js-exit-this-page-skiplink')\n    if ($skiplinkButton instanceof HTMLAnchorElement) {\n      this.$skiplinkButton = $skiplinkButton\n    }\n\n    this.buildIndicator()\n    this.initUpdateSpan()\n    this.initButtonClickHandler()\n\n    // Check to see if this has already been done by a previous initialisation of ExitThisPage\n    if (!('govukFrontendExitThisPageKeypress' in document.body.dataset)) {\n      document.addEventListener('keyup', this.handleKeypress.bind(this), true)\n      document.body.dataset.govukFrontendExitThisPageKeypress = 'true'\n    }\n\n    // When the page is restored after navigating 'back' in some browsers the\n    // blank overlay remains present, rendering the page unusable. Here, we check\n    // to see if it's present on page (re)load, and remove it if so.\n    window.addEventListener('pageshow', this.resetPage.bind(this))\n  }\n\n  /**\n   * Create the <span> we use for screen reader announcements.\n   *\n   * @private\n   */\n  initUpdateSpan () {\n    this.$updateSpan = document.createElement('span')\n    this.$updateSpan.setAttribute('role', 'status')\n    this.$updateSpan.className = 'govuk-visually-hidden'\n\n    this.$module.appendChild(this.$updateSpan)\n  }\n\n  /**\n   * Create button click handlers.\n   *\n   * @private\n   */\n  initButtonClickHandler () {\n    // Main EtP button\n    this.$button.addEventListener('click', this.handleClick.bind(this))\n\n    // EtP secondary link\n    if (this.$skiplinkButton) {\n      this.$skiplinkButton.addEventListener('click', this.handleClick.bind(this))\n    }\n  }\n\n  /**\n   * Create the HTML for the 'three lights' indicator on the button.\n   *\n   * @private\n   */\n  buildIndicator () {\n    // Build container\n    // Putting `aria-hidden` on it as it won't contain any readable information\n    this.$indicatorContainer = document.createElement('div')\n    this.$indicatorContainer.className = 'govuk-exit-this-page__indicator'\n    this.$indicatorContainer.setAttribute('aria-hidden', 'true')\n\n    // Create three 'lights' and place them within the container\n    for (let i = 0; i < 3; i++) {\n      const $indicator = document.createElement('div')\n      $indicator.className = 'govuk-exit-this-page__indicator-light'\n      this.$indicatorContainer.appendChild($indicator)\n    }\n\n    // Append it all to the module\n    this.$button.appendChild(this.$indicatorContainer)\n  }\n\n  /**\n   * Update whether the lights are visible and which ones are lit up depending on\n   * the value of `keypressCounter`.\n   *\n   * @private\n   */\n  updateIndicator () {\n    // Show or hide the indicator container depending on keypressCounter value\n    if (this.keypressCounter > 0) {\n      this.$indicatorContainer.classList.add('govuk-exit-this-page__indicator--visible')\n    } else {\n      this.$indicatorContainer.classList.remove('govuk-exit-this-page__indicator--visible')\n    }\n\n    // Turn on only the indicators we want on\n    const $indicators = this.$indicatorContainer.querySelectorAll(\n      '.govuk-exit-this-page__indicator-light'\n    )\n    $indicators.forEach(($indicator, index) => {\n      $indicator.classList.toggle(\n        'govuk-exit-this-page__indicator-light--on',\n        index < this.keypressCounter\n      )\n    })\n  }\n\n  /**\n   * Initiates the redirection away from the current page.\n   * Includes the loading overlay functionality, which covers the current page with a\n   * white overlay so that the contents are not visible during the loading\n   * process. This is particularly important on slow network connections.\n   *\n   * @private\n   */\n  exitPage () {\n    this.$updateSpan.innerText = ''\n\n    // Blank the page\n    // As well as creating an overlay with text, we also set the body to hidden\n    // to prevent screen reader and sequential navigation users potentially\n    // navigating through the page behind the overlay during loading\n    document.body.classList.add('govuk-exit-this-page-hide-content')\n    this.$overlay = document.createElement('div')\n    this.$overlay.className = 'govuk-exit-this-page-overlay'\n    this.$overlay.setAttribute('role', 'alert')\n\n    // we do these this way round, thus incurring a second paint, because changing\n    // the element text after adding it means that screen readers pick up the\n    // announcement more reliably.\n    document.body.appendChild(this.$overlay)\n    this.$overlay.innerText = this.i18n.t('activated')\n\n    window.location.href = this.$button.getAttribute('href')\n  }\n\n  /**\n   * Pre-activation logic for when the button is clicked/activated via mouse or\n   * pointer.\n   *\n   * We do this to differentiate it from the keyboard activation event because we\n   * need to run `e.preventDefault` as the button or skiplink are both links and we\n   * want to apply some additional logic in `exitPage` before navigating.\n   *\n   * @private\n   * @param {MouseEvent} event - mouse click event\n   */\n  handleClick (event) {\n    event.preventDefault()\n    this.exitPage()\n  }\n\n  /**\n   * Logic for the 'quick escape' keyboard sequence functionality (pressing the\n   * Shift key three times without interruption, within a time limit).\n   *\n   * @private\n   * @param {KeyboardEvent} event - keyup event\n   */\n  handleKeypress (event) {\n    // Detect if the 'Shift' key has been pressed. We want to only do things if it\n    // was pressed by itself and not in a combination with another keyâ€”so we keep\n    // track of whether the preceding keyup had shiftKey: true on it, and if it\n    // did, we ignore the next Shift keyup event.\n    //\n    // This works because using Shift as a modifier key (e.g. pressing Shift + A)\n    // will fire TWO keyup events, one for A (with e.shiftKey: true) and the other\n    // for Shift (with e.shiftKey: false).\n    if (\n      (event.key === 'Shift' || event.keyCode === 16 || event.which === 16) &&\n      !this.lastKeyWasModified\n    ) {\n      this.keypressCounter += 1\n\n      // Update the indicator before the below if statement can reset it back to 0\n      this.updateIndicator()\n\n      // Clear the timeout for the keypress timeout message clearing itself\n      if (this.timeoutMessageId !== null) {\n        window.clearTimeout(this.timeoutMessageId)\n        this.timeoutMessageId = null\n      }\n\n      if (this.keypressCounter >= 3) {\n        this.keypressCounter = 0\n\n        if (this.keypressTimeoutId !== null) {\n          window.clearTimeout(this.keypressTimeoutId)\n          this.keypressTimeoutId = null\n        }\n\n        this.exitPage()\n      } else {\n        if (this.keypressCounter === 1) {\n          this.$updateSpan.innerText = this.i18n.t('pressTwoMoreTimes')\n        } else {\n          this.$updateSpan.innerText = this.i18n.t('pressOneMoreTime')\n        }\n      }\n\n      this.setKeypressTimer()\n    } else if (this.keypressTimeoutId !== null) {\n      // If the user pressed any key other than 'Shift', after having pressed\n      // 'Shift' and activating the timer, stop and reset the timer.\n      this.resetKeypressTimer()\n    }\n\n    // Keep track of whether the Shift modifier key was held during this keypress\n    this.lastKeyWasModified = event.shiftKey\n  }\n\n  /**\n   * Starts the 'quick escape' keyboard sequence timer.\n   *\n   * This can be invoked several times. We want this to be possible so that the\n   * timer is restarted each time the shortcut key is pressed (e.g. the user has\n   * up to n seconds between each keypress, rather than n seconds to invoke the\n   * entire sequence.)\n   *\n   * @private\n   */\n  setKeypressTimer () {\n    // Clear any existing timeout. This is so only one timer is running even if\n    // there are multiple keypresses in quick succession.\n    window.clearTimeout(this.keypressTimeoutId)\n\n    // Set a fresh timeout\n    this.keypressTimeoutId = window.setTimeout(\n      this.resetKeypressTimer.bind(this),\n      this.timeoutTime\n    )\n  }\n\n  /**\n   * Stops and resets the 'quick escape' keyboard sequence timer.\n   *\n   * @private\n   */\n  resetKeypressTimer () {\n    window.clearTimeout(this.keypressTimeoutId)\n    this.keypressTimeoutId = null\n\n    this.keypressCounter = 0\n    this.$updateSpan.innerText = this.i18n.t('timedOut')\n\n    this.timeoutMessageId = window.setTimeout(() => {\n      this.$updateSpan.innerText = ''\n    }, this.timeoutTime)\n\n    this.updateIndicator()\n  }\n\n  /**\n   * Reset the page using the EtP button\n   *\n   * We use this in situations where a user may re-enter a page using the browser\n   * back button. In these cases, the browser can choose to restore the state of\n   * the page as it was previously, including restoring the 'ghost page' overlay,\n   * the announcement span having it's role set to \"alert\" and the keypress\n   * indicator still active, leaving the page in an unusable state.\n   *\n   * By running this check when the page is shown, we can programatically restore\n   * the page and the component to a \"default\" state\n   *\n   * @deprecated Will be made private in v5.0\n   */\n  resetPage () {\n    // If an overlay is set, remove it and reset the value\n    document.body.classList.remove('govuk-exit-this-page-hide-content')\n\n    if (this.$overlay) {\n      this.$overlay.remove()\n      this.$overlay = null\n    }\n\n    // Ensure the announcement span's role is status, not alert and clear any text\n    this.$updateSpan.setAttribute('role', 'status')\n    this.$updateSpan.innerText = ''\n\n    // Sync the keypress indicator lights\n    this.updateIndicator()\n\n    // If the timeouts are active, clear them\n    if (this.keypressTimeoutId) {\n      window.clearTimeout(this.keypressTimeoutId)\n    }\n\n    if (this.timeoutMessageId) {\n      window.clearTimeout(this.timeoutMessageId)\n    }\n  }\n\n  /**\n   * Exit this page default config\n   *\n   * @see {@link ExitThisPageConfig}\n   * @constant\n   * @default\n   * @type {ExitThisPageConfig}\n   */\n  static defaults = Object.freeze({\n    i18n: {\n      activated: 'Loading.',\n      timedOut: 'Exit this page expired.',\n      pressTwoMoreTimes: 'Shift, press 2 more times to exit.',\n      pressOneMoreTime: 'Shift, press 1 more time to exit.'\n    }\n  })\n}\n\n/**\n * Exit this Page config\n *\n * @see {@link ExitThisPage.defaults}\n * @typedef {object} ExitThisPageConfig\n * @property {ExitThisPageTranslations} [i18n=ExitThisPage.defaults.i18n] - Exit this page translations\n */\n\n/**\n * Exit this Page translations\n *\n * @see {@link ExitThisPage.defaults.i18n}\n * @typedef {object} ExitThisPageTranslations\n *\n * Messages used by the component programatically inserted text, including\n * overlay text and screen reader announcements.\n * @property {string} [activated] - Screen reader announcement for when EtP\n *   keypress functionality has been successfully activated.\n * @property {string} [timedOut] - Screen reader announcement for when the EtP\n *   keypress functionality has timed out.\n * @property {string} [pressTwoMoreTimes] - Screen reader announcement informing\n *   the user they must press the activation key two more times.\n * @property {string} [pressOneMoreTime] - Screen reader announcement informing\n *   the user they must press the activation key one more time.\n */\n"],"names":["ExitThisPage","constructor","$module","config","i18n","$button","$skiplinkButton","$updateSpan","$indicatorContainer","$overlay","keypressCounter","lastKeyWasModified","timeoutTime","keypressTimeoutId","timeoutMessageId","HTMLElement","document","body","classList","contains","querySelector","mergeConfigs","defaults","normaliseDataset","dataset","I18n","extractConfigByNamespace","HTMLAnchorElement","buildIndicator","initUpdateSpan","initButtonClickHandler","addEventListener","handleKeypress","bind","govukFrontendExitThisPageKeypress","window","resetPage","createElement","setAttribute","className","appendChild","handleClick","i","$indicator","updateIndicator","add","remove","$indicators","querySelectorAll","forEach","index","toggle","exitPage","innerText","t","location","href","getAttribute","event","preventDefault","key","keyCode","which","clearTimeout","setKeypressTimer","resetKeypressTimer","shiftKey","setTimeout","Object","freeze","activated","timedOut","pressTwoMoreTimes","pressOneMoreTime"],"mappings":"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"}