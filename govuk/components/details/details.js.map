{"version":3,"file":"details.js","sources":["../../../../src/govuk/common/index.mjs","../../../../src/govuk/components/details/details.mjs"],"sourcesContent":["/**\n * Common helpers which do not require polyfill.\n *\n * IMPORTANT: If a helper require a polyfill, please isolate it in its own module\n * so that the polyfill can be properly tree-shaken and does not burden\n * the components that do not need that helper\n *\n * @module common/index\n */\n\n/**\n * Used to generate a unique string, allows multiple instances of the component\n * without them conflicting with each other.\n * https://stackoverflow.com/a/8809472\n *\n * @deprecated Will be made private in v5.0\n * @returns {string} Unique ID\n */\nexport function generateUniqueID () {\n  var d = new Date().getTime()\n  if (typeof window.performance !== 'undefined' && typeof window.performance.now === 'function') {\n    d += window.performance.now() // use high-precision timer if available\n  }\n  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {\n    var r = (d + Math.random() * 16) % 16 | 0\n    d = Math.floor(d / 16)\n    return (c === 'x' ? r : (r & 0x3 | 0x8)).toString(16)\n  })\n}\n\n/**\n * Config flattening function\n *\n * Takes any number of objects, flattens them into namespaced key-value pairs,\n * (e.g. \\{'i18n.showSection': 'Show section'\\}) and combines them together, with\n * greatest priority on the LAST item passed in.\n *\n * @deprecated Will be made private in v5.0\n * @returns {{ [key: string]: unknown }} A flattened object of key-value pairs.\n */\nexport function mergeConfigs (/* configObject1, configObject2, ...configObjects */) {\n  /**\n   * Function to take nested objects and flatten them to a dot-separated keyed\n   * object. Doing this means we don't need to do any deep/recursive merging of\n   * each of our objects, nor transform our dataset from a flat list into a\n   * nested object.\n   *\n   * @param {{ [key: string]: unknown }} configObject - Deeply nested object\n   * @returns {{ [key: string]: unknown }} Flattened object with dot-separated keys\n   */\n  var flattenObject = function (configObject) {\n    // Prepare an empty return object\n    /** @type {{ [key: string]: unknown }} */\n    var flattenedObject = {}\n\n    /**\n     * Our flattening function, this is called recursively for each level of\n     * depth in the object. At each level we prepend the previous level names to\n     * the key using `prefix`.\n     *\n     * @param {Partial<{ [key: string]: unknown }>} obj - Object to flatten\n     * @param {string} [prefix] - Optional dot-separated prefix\n     */\n    var flattenLoop = function (obj, prefix) {\n      // Loop through keys...\n      for (var key in obj) {\n        // Check to see if this is a prototypical key/value,\n        // if it is, skip it.\n        if (!Object.prototype.hasOwnProperty.call(obj, key)) {\n          continue\n        }\n        var value = obj[key]\n        var prefixedKey = prefix ? prefix + '.' + key : key\n        if (typeof value === 'object') {\n          // If the value is a nested object, recurse over that too\n          flattenLoop(value, prefixedKey)\n        } else {\n          // Otherwise, add this value to our return object\n          flattenedObject[prefixedKey] = value\n        }\n      }\n    }\n\n    // Kick off the recursive loop\n    flattenLoop(configObject)\n    return flattenedObject\n  }\n\n  // Start with an empty object as our base\n  /** @type {{ [key: string]: unknown }} */\n  var formattedConfigObject = {}\n\n  // Loop through each of the remaining passed objects and push their keys\n  // one-by-one into configObject. Any duplicate keys will override the existing\n  // key with the new value.\n  for (var i = 0; i < arguments.length; i++) {\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-argument -- Ignore mismatch between arguments types\n    var obj = flattenObject(arguments[i])\n    for (var key in obj) {\n      if (Object.prototype.hasOwnProperty.call(obj, key)) {\n        formattedConfigObject[key] = obj[key]\n      }\n    }\n  }\n\n  return formattedConfigObject\n}\n\n/**\n * Extracts keys starting with a particular namespace from a flattened config\n * object, removing the namespace in the process.\n *\n * @deprecated Will be made private in v5.0\n * @param {{ [key: string]: unknown }} configObject - The object to extract key-value pairs from.\n * @param {string} namespace - The namespace to filter keys with.\n * @returns {{ [key: string]: unknown }} Flattened object with dot-separated key namespace removed\n * @throws {Error} Config object required\n * @throws {Error} Namespace string required\n */\nexport function extractConfigByNamespace (configObject, namespace) {\n  // Check we have what we need\n  if (!configObject || typeof configObject !== 'object') {\n    throw new Error('Provide a `configObject` of type \"object\".')\n  }\n\n  if (!namespace || typeof namespace !== 'string') {\n    throw new Error('Provide a `namespace` of type \"string\" to filter the `configObject` by.')\n  }\n\n  /** @type {{ [key: string]: unknown }} */\n  var newObject = {}\n\n  for (var key in configObject) {\n    // Split the key into parts, using . as our namespace separator\n    var keyParts = key.split('.')\n    // Check if the first namespace matches the configured namespace\n    if (Object.prototype.hasOwnProperty.call(configObject, key) && keyParts[0] === namespace) {\n      // Remove the first item (the namespace) from the parts array,\n      // but only if there is more than one part (we don't want blank keys!)\n      if (keyParts.length > 1) {\n        keyParts.shift()\n      }\n      // Join the remaining parts back together\n      var newKey = keyParts.join('.')\n      // Add them to our new object\n      newObject[newKey] = configObject[key]\n    }\n  }\n  return newObject\n}\n","/**\n * JavaScript 'polyfill' for HTML5's <details> and <summary> elements\n * and 'shim' to add accessiblity enhancements for all browsers\n *\n * http://caniuse.com/#feat=details\n */\nimport { generateUniqueID } from '../../common/index.mjs'\n\nvar KEY_ENTER = 13\nvar KEY_SPACE = 32\n\n/**\n * Details component\n *\n * @class\n * @param {Element} $module - HTML element to use for details\n */\nfunction Details ($module) {\n  if (!($module instanceof HTMLElement)) {\n    return this\n  }\n\n  /** @deprecated Will be made private in v5.0 */\n  this.$module = $module\n\n  /** @deprecated Will be made private in v5.0 */\n  this.$summary = null\n\n  /** @deprecated Will be made private in v5.0 */\n  this.$content = null\n}\n\n/**\n * Initialise component\n */\nDetails.prototype.init = function () {\n  // Check that required elements are present\n  if (!this.$module) {\n    return\n  }\n\n  // If there is native details support, we want to avoid running code to polyfill native behaviour.\n  var hasNativeDetails = 'HTMLDetailsElement' in window &&\n    this.$module instanceof HTMLDetailsElement\n\n  if (!hasNativeDetails) {\n    this.polyfillDetails()\n  }\n}\n\n/**\n * Polyfill component in older browsers\n *\n * @deprecated Will be made private in v5.0\n */\nDetails.prototype.polyfillDetails = function () {\n  var $module = this.$module\n\n  // Save shortcuts to the inner summary and content elements\n  var $summary = this.$summary = $module.getElementsByTagName('summary').item(0)\n  var $content = this.$content = $module.getElementsByTagName('div').item(0)\n\n  // If <details> doesn't have a <summary> and a <div> representing the content\n  // it means the required HTML structure is not met so the script will stop\n  if (!$summary || !$content) {\n    return\n  }\n\n  // If the content doesn't have an ID, assign it one now\n  // which we'll need for the summary's aria-controls assignment\n  if (!$content.id) {\n    $content.id = 'details-content-' + generateUniqueID()\n  }\n\n  // Add ARIA role=\"group\" to details\n  $module.setAttribute('role', 'group')\n\n  // Add role=button to summary\n  $summary.setAttribute('role', 'button')\n\n  // Add aria-controls\n  $summary.setAttribute('aria-controls', $content.id)\n\n  // Set tabIndex so the summary is keyboard accessible for non-native elements\n  //\n  // We have to use the camelcase `tabIndex` property as there is a bug in IE6/IE7 when we set the correct attribute lowercase:\n  // See http://web.archive.org/web/20170120194036/http://www.saliences.com/browserBugs/tabIndex.html for more information.\n  $summary.tabIndex = 0\n\n  // Detect initial open state\n  if (this.$module.hasAttribute('open')) {\n    $summary.setAttribute('aria-expanded', 'true')\n  } else {\n    $summary.setAttribute('aria-expanded', 'false')\n    $content.style.display = 'none'\n  }\n\n  // Bind an event to handle summary elements\n  this.polyfillHandleInputs(this.polyfillSetAttributes.bind(this))\n}\n\n/**\n * Define a statechange function that updates aria-expanded and style.display\n *\n * @deprecated Will be made private in v5.0\n * @returns {boolean} Returns true\n */\nDetails.prototype.polyfillSetAttributes = function () {\n  if (this.$module.hasAttribute('open')) {\n    this.$module.removeAttribute('open')\n    this.$summary.setAttribute('aria-expanded', 'false')\n    this.$content.style.display = 'none'\n  } else {\n    this.$module.setAttribute('open', 'open')\n    this.$summary.setAttribute('aria-expanded', 'true')\n    this.$content.style.display = ''\n  }\n\n  return true\n}\n\n/**\n * Handle cross-modal click events\n *\n * @deprecated Will be made private in v5.0\n * @param {(event: UIEvent) => void} callback - function\n */\nDetails.prototype.polyfillHandleInputs = function (callback) {\n  this.$summary.addEventListener('keypress', function (event) {\n    var $target = event.target\n    // When the key gets pressed - check if it is enter or space\n    if (event.keyCode === KEY_ENTER || event.keyCode === KEY_SPACE) {\n      if ($target instanceof HTMLElement && $target.nodeName.toLowerCase() === 'summary') {\n        // Prevent space from scrolling the page\n        // and enter from submitting a form\n        event.preventDefault()\n        // Click to let the click event do all the necessary action\n        if ($target.click) {\n          $target.click()\n        } else {\n          // except Safari 5.1 and under don't support .click() here\n          callback(event)\n        }\n      }\n    }\n  })\n\n  // Prevent keyup to prevent clicking twice in Firefox when using space key\n  this.$summary.addEventListener('keyup', function (event) {\n    var $target = event.target\n    if (event.keyCode === KEY_SPACE) {\n      if ($target instanceof HTMLElement && $target.nodeName.toLowerCase() === 'summary') {\n        event.preventDefault()\n      }\n    }\n  })\n\n  this.$summary.addEventListener('click', callback)\n}\n\nexport default Details\n"],"names":[],"mappings":"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"}